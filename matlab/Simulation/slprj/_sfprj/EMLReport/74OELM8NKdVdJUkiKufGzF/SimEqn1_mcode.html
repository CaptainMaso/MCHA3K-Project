<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type0" id="S2T0U3">thetadd</span>, <span class="var type0" id="S3T0U4">phidd</span>] = SimEqn(<span class="var type1" id="S4T1U7">theta</span>, <span class="var type1" id="S5T1U8">thetad</span>, <span class="var type1" id="S6T1U9">phi</span>, <span class="var type1" id="S7T2U10">phid</span>, <span class="var type1" id="S8T2U11">Tau</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,2" id="srcline2"> 2</a></span><span class="line"><span class="comment">%#codegen</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,3" id="srcline3"> 3</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,4" id="srcline4"> 4</a></span><span class="line">coder.extrinsic(<span class="string">'evalin'</span>, <span class="string">'assignin'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,5" id="srcline5"> 5</a></span><span class="line"><span class="mxinfo " id="T3:U6"><span class="var type1" id="S10T3U21">param</span> = <span class="mxinfo " id="T3:U8">struct(<span class="string">'alpha'</span>, <span class="mxinfo " id="T5:U9">{}</span>, <span class="string">'M'</span>, <span class="mxinfo " id="T6:U10">{}</span>, <span class="string">'I'</span>, <span class="mxinfo " id="T7:U11">{}</span>, <span class="string">'l'</span>, <span class="mxinfo " id="T8:U12">{}</span>, <span class="string">'m'</span>, <span class="mxinfo " id="T9:U13">{}</span>, <span class="string">'J'</span>, <span class="mxinfo " id="T10:U14">{}</span>, <span class="string">'r'</span>, <span class="mxinfo " id="T11:U15">{}</span>, <span class="string">'g'</span>, <span class="mxinfo " id="T12:U16">{}</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,6" id="srcline6"> 6</a></span><span class="line"><span class="mxinfo " id="T3:U17"><span class="var type1" id="S10T3U50">param</span> = <span class="mxinfo " id="T13:U19"><span class="extrinsicFcn" id="F15N3:B52">assignin</span>(<span class="mxinfo " id="T14:U20"><span class="string">'base'</span></span>, <span class="mxinfo " id="T15:U21"><span class="string">'params'</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,7" id="srcline7"> 7</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,8" id="srcline8"> 8</a></span><span class="line"><span class="var type0" id="S13T0U57">alpha</span> = <span class="message error" id="M1F1C"><span class="var type1" id="S10T3U59">param</span>.alpha</span>; <span class="comment">% Slope Angle</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,9" id="srcline9"> 9</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,10" id="srcline10">10</a></span><span class="line"><span class="var type0" id="S14T0U63">M</span> = <span class="message error" id="M2F1C"><span class="var type1" id="S10T3U65">param</span>.M</span>;<span class="comment">% Chassis Mass</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,11" id="srcline11">11</a></span><span class="line"><span class="var type0" id="S15T0U69">I</span> = <span class="message error" id="M3F1C"><span class="var type1" id="S10T3U71">param</span>.I</span>;<span class="comment">% Moment of Inertia</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,12" id="srcline12">12</a></span><span class="line"><span class="var type0" id="S16T0U75">l</span> = <span class="message error" id="M4F1C"><span class="var type1" id="S10T3U77">param</span>.l</span>;<span class="comment">% CoG to rotation point</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,13" id="srcline13">13</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,14" id="srcline14">14</a></span><span class="line"><span class="var type0" id="S17T0U81">m</span> = <span class="message error" id="M5F1C"><span class="var type1" id="S10T3U83">param</span>.m</span>;<span class="comment">% Wheel Mass</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,15" id="srcline15">15</a></span><span class="line"><span class="var type0" id="S18T0U87">J</span> = <span class="message error" id="M6F1C"><span class="var type1" id="S10T3U89">param</span>.J</span>;<span class="comment">% Wheel Moment of Inertia</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,16" id="srcline16">16</a></span><span class="line"><span class="var type0" id="S19T0U93">r</span> = <span class="message error" id="M7F1C"><span class="var type1" id="S10T3U95">param</span>.r</span>;<span class="comment">% Wheel Radius</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,17" id="srcline17">17</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,18" id="srcline18">18</a></span><span class="line"><span class="mxinfo " id="T2:U29"><span class="var type1" id="S20T2U99">g</span> = <span class="mxinfo " id="T2:U31">9.81</span></span>; <span class="comment">% Gravity</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,19" id="srcline19">19</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,20" id="srcline20">20</a></span><span class="line"><span class="var type0" id="S21T0U103">MassMatrix</span> = [(<span class="var type0" id="S18T0U109"><span class="message error" id="M8F1C">J</span></span> + (<span class="var type0" id="S14T0U113">M</span>+<span class="var type0" id="S17T0U114">m</span>)*<span class="var type0" id="S19T0U116">r</span>^2 + <span class="var type0" id="S14T0U121">M</span>*<span class="var type0" id="S16T0U122">l</span>*<span class="var type0" id="S19T0U123">r</span>*cos(<span class="var type0" id="S13T0U127">alpha</span>+<span class="var type0" id="S4T0U128">theta</span>)), <span class="var type0" id="S18T0U130">J</span>+(<span class="var type0" id="S14T0U134">M</span>+<span class="var type0" id="S17T0U135">m</span>)*<span class="var type0" id="S19T0U137">r</span>^2;  (<span class="var type0" id="S18T0U145">J</span> + (<span class="var type0" id="S14T0U149">M</span>+<span class="var type0" id="S17T0U150">m</span>)*<span class="var type0" id="S19T0U152">r</span>^2 + 2*<span class="var type0" id="S14T0U159">M</span>*<span class="var type0" id="S16T0U160">l</span>*<span class="var type0" id="S19T0U161">r</span>*cos(<span class="var type0" id="S13T0U165">alpha</span>+<span class="var type0" id="S4T0U166">theta</span>)+ <span class="var type0" id="S14T0U168">M</span>*<span class="var type0" id="S16T0U170">l</span>^2 + <span class="var type0" id="S15T0U172">I</span>), (<span class="var type0" id="S18T0U176">J</span> + (<span class="var type0" id="S14T0U180">M</span>+<span class="var type0" id="S17T0U181">m</span>)*<span class="var type0" id="S19T0U183">r</span>^2 + <span class="var type0" id="S14T0U188">M</span>*<span class="var type0" id="S16T0U189">l</span>*<span class="var type0" id="S19T0U190">r</span>*cos(<span class="var type0" id="S13T0U194">alpha</span>+<span class="var type0" id="S4T0U195">theta</span>))];</span></span>
<span class="srcline"><span class="lineno"><a href="1,21" id="srcline21">21</a></span><span class="line"><span class="mxinfo " id="T16:U32"><span class="var type1" id="S23T16U198">Forces</span> = <span class="mxinfo " id="T16:U34">[<span class="var type1" id="S8T2U201">Tau</span>;<span class="mxinfo " id="T2:U36">0</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,22" id="srcline22">22</a></span><span class="line"><span class="var type0" id="S24T0U206">Eqns</span> = [<span class="var type0" id="S14T0U214"><span class="message error" id="M9F1C">M</span></span>*<span class="var type0" id="S16T0U215">l</span>*<span class="var type0" id="S19T0U216">r</span>*sin(<span class="var type0" id="S13T0U220">alpha</span>+<span class="var type0" id="S4T0U221">theta</span>)*<span class="var type0" id="S5T0U223">thetad</span>^2 - (<span class="var type0" id="S14T0U230">M</span>+<span class="var type0" id="S17T0U231">m</span>)*<span class="var type0" id="S20T0U232">g</span>*<span class="var type0" id="S19T0U233">r</span>*sin(<span class="var type0" id="S13T0U236">alpha</span>); <span class="var type0" id="S14T0U244">M</span>*<span class="var type0" id="S16T0U245">l</span>*<span class="var type0" id="S19T0U246">r</span>*sin(<span class="var type0" id="S13T0U250">alpha</span>+<span class="var type0" id="S4T0U251">theta</span>)*<span class="var type0" id="S5T0U253">thetad</span>^2 + <span class="var type0" id="S14T0U258">M</span>*<span class="var type0" id="S20T0U259">g</span>*<span class="var type0" id="S16T0U260">l</span>*sin(<span class="var type0" id="S4T0U263">theta</span>) + (<span class="var type0" id="S14T0U269">M</span>+<span class="var type0" id="S17T0U270">m</span>)*<span class="var type0" id="S20T0U271">g</span>*<span class="var type0" id="S19T0U272">r</span>*sin(<span class="var type0" id="S13T0U275">alpha</span>)];</span></span>
<span class="srcline"><span class="lineno"><a href="1,23" id="srcline23">23</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,24" id="srcline24">24</a></span><span class="line"><span class="var type0" id="S26T0U278">Res</span> = dot(inv(<span class="var type0" id="S21T0U283"><span class="message error" id="M10F1C">MassMatrix</span></span>), <span class="var type0" id="S23T0U285">Forces</span> + <span class="var type0" id="S24T0U286">Eqns</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,25" id="srcline25">25</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,26" id="srcline26">26</a></span><span class="line"><span class="var type0" id="S2T0U289">thetadd</span> = <span class="var type0" id="S26T0U291"><span class="message error" id="M11F1C">Res</span></span>(1);</span></span>
<span class="srcline"><span class="lineno"><a href="1,27" id="srcline27">27</a></span><span class="line"><span class="var type0" id="S3T0U295">phidd</span> = <span class="var type0" id="S26T0U297"><span class="message error" id="M12F1C">Res</span></span>(2);</span></span>
</pre>
