<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="8,22" id="srcline22"> 22</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="8,23" id="srcline23"> 23</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S27T10U167">Theta</span>, <span class="var type1" id="S28T10U168">dTheta</span>, <span class="var type1" id="S29T13U169">Bias</span>, <span class="var type1" id="S30T34U170">P</span>] = TimeUpdate(<span class="var type1" id="S31T4U173">Theta_p</span>, <span class="var type1" id="S32T4U174">dTheta_p</span>, <span class="var type1" id="S33T5U175">Bias_p</span>, <span class="var type1" id="S34T6U176">P_p</span>, <span class="var type1" id="S35T7U177">qw</span>, <span class="var type1" id="S36T8U178">qb</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="8,24" id="srcline24"> 24</a></span><span class="line">    <span class="mxinfo " id="T3:U11"><span class="var type1" id="S37T221U181">fm</span> = <span class="mxinfo " id="T3:U13"><span class="fcn" id="F37N10:B183">get_fimath</span>()</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="8,25" id="srcline25"> 25</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="8,26" id="srcline26"> 26</a></span><span class="line">    <span class="keyword">global</span> <span class="var type0" id="S39T0U185">T</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="8,27" id="srcline27"> 27</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="8,28" id="srcline28"> 28</a></span><span class="line">    <span class="comment">% State Update</span></span></span>
<span class="srcline"><span class="lineno"><a href="8,29" id="srcline29"> 29</a></span><span class="line">    <span class="mxinfo " id="T10:U14"><span class="var type1" id="S28T10U188">dTheta</span> = <span class="mxinfo " id="T10:U16">fi(<span class="var type1" id="S32T4U191">dTheta_p</span>, 1, 16, 4, <span class="var type1" id="S37T221U195">fm</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="8,30" id="srcline30"> 30</a></span><span class="line">    <span class="mxinfo " id="T10:U19"><span class="var type1" id="S27T10U198">Theta</span>  = <span class="mxinfo " id="T10:U21">fi(<span class="mxinfo " id="T11:U22"><span class="mxinfo " id="T12:U23"><span class="var type2" id="S39T1V1U203">T</span>*<span class="var type1" id="S32T4U204">dTheta_p</span></span> + <span class="var type1" id="S31T4U205">Theta_p</span></span>, 1, 16, 4, <span class="var type1" id="S37T221U209">fm</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="8,31" id="srcline31"> 31</a></span><span class="line">    <span class="mxinfo " id="T13:U28"><span class="var type1" id="S29T13U212">Bias</span> = <span class="mxinfo " id="T13:U30">fi(<span class="var type1" id="S33T5U215">Bias_p</span>, 1, 16, 9, <span class="var type1" id="S37T221U219">fm</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="8,32" id="srcline32"> 32</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="8,33" id="srcline33"> 33</a></span><span class="line">    <span class="comment">% Covariance Update</span></span></span>
<span class="srcline"><span class="lineno"><a href="8,34" id="srcline34"> 34</a></span><span class="line">    <span class="mxinfo " id="T14:U33"><span class="var type1" id="S41T14U222">Pbb_p</span> = <span class="mxinfo " id="T14:U35">fi(<span class="mxinfo " id="T246:U36"><span class="var type1" id="S34T6U226">P_p</span>(<span class="mxinfo " id="T223:U38">3</span>,<span class="mxinfo " id="T223:U39">3</span>)</span>, 0, 16, 13, <span class="var type1" id="S37T221U232">fm</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="8,35" id="srcline35"> 35</a></span><span class="line">    <span class="mxinfo " id="T13:U41"><span class="var type1" id="S42T13U235">Ptb_p</span> = <span class="mxinfo " id="T13:U43">fi(<span class="mxinfo " id="T246:U44"><span class="var type1" id="S34T6U239">P_p</span>(<span class="mxinfo " id="T223:U46">2</span>,<span class="mxinfo " id="T223:U47">3</span>)</span>, 1, 16, 9, <span class="var type1" id="S37T221U245">fm</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="8,36" id="srcline36"> 36</a></span><span class="line">    <span class="mxinfo " id="T15:U49"><span class="var type1" id="S43T15U248">Ptt_p</span> = <span class="mxinfo " id="T15:U51">fi(<span class="mxinfo " id="T246:U52"><span class="var type1" id="S34T6U252">P_p</span>(<span class="mxinfo " id="T223:U54">2</span>,<span class="mxinfo " id="T223:U55">2</span>)</span>, 0, 16, 6, <span class="var type1" id="S37T221U258">fm</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="8,37" id="srcline37"> 37</a></span><span class="line">    <span class="mxinfo " id="T16:U57"><span class="var type1" id="S44T16U261">Pwb_p</span> = <span class="mxinfo " id="T16:U59">fi(<span class="mxinfo " id="T246:U60"><span class="var type1" id="S34T6U265">P_p</span>(<span class="mxinfo " id="T223:U62">1</span>,<span class="mxinfo " id="T223:U63">3</span>)</span>, 1, 16, 12, <span class="var type1" id="S37T221U271">fm</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="8,38" id="srcline38"> 38</a></span><span class="line">    <span class="mxinfo " id="T17:U65"><span class="var type1" id="S45T17U274">Pwt_p</span> = <span class="mxinfo " id="T17:U67">fi(<span class="mxinfo " id="T246:U68"><span class="var type1" id="S34T6U278">P_p</span>(<span class="mxinfo " id="T223:U70">1</span>,<span class="mxinfo " id="T223:U71">2</span>)</span>, 0, 16, 10, <span class="var type1" id="S37T221U284">fm</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="8,39" id="srcline39"> 39</a></span><span class="line">    <span class="mxinfo " id="T14:U73"><span class="var type1" id="S46T14U287">Pww_p</span> = <span class="mxinfo " id="T14:U75">fi(<span class="mxinfo " id="T246:U76"><span class="var type1" id="S34T6U291">P_p</span>(<span class="mxinfo " id="T223:U78">1</span>,<span class="mxinfo " id="T223:U79">1</span>)</span>, 0, 16, 13, <span class="var type1" id="S37T221U297">fm</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="8,40" id="srcline40"> 40</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="8,41" id="srcline41"> 41</a></span><span class="line">    <span class="mxinfo " id="T14:U81"><span class="var type1" id="S47T14U300">Pbb</span> = <span class="mxinfo " id="T14:U83">fi(<span class="mxinfo " id="T18:U84"><span class="var type1" id="S41T14U304">Pbb_p</span> + <span class="mxinfo " id="T19:U86"><span class="var type1" id="S39T1U306">T</span>*<span class="var type1" id="S36T8U307">qb</span></span></span>, 0, 16, 13, <span class="var type1" id="S37T221U311">fm</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="8,42" id="srcline42"> 42</a></span><span class="line">    <span class="mxinfo " id="T13:U90"><span class="var type1" id="S48T13U314">Ptb</span> = <span class="mxinfo " id="T13:U92">fi(<span class="mxinfo " id="T20:U93"><span class="mxinfo " id="T21:U94"><span class="var type1" id="S39T1U319">T</span>*<span class="var type1" id="S44T16U320">Pwb_p</span></span>+<span class="var type1" id="S42T13U321">Ptb_p</span></span>, 1, 16, 9, <span class="var type1" id="S37T221U325">fm</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="8,43" id="srcline43"> 43</a></span><span class="line">    <span class="mxinfo " id="T15:U99"><span class="var type1" id="S49T15U328">Ptt</span> = <span class="mxinfo " id="T15:U101">fi(<span class="mxinfo  fixpt" id="T22:U102"><span class="mxinfo " id="T23:U103"><span class="mxinfo " id="T24:U104"><span class="var type1" id="S43T15U334">Ptt_p</span> + <span class="mxinfo " id="T25:U106"><span class="var type1" id="S39T1U337">T</span>^2*<span class="var type1" id="S46T14U339">Pww_p</span></span></span> + <span class="mxinfo " id="T26:U109"><span class="mxinfo " id="T291:U110">fi(2*<span class="var type1" id="S39T1U345">T</span>, 0, 16, 22, <span class="var type1" id="S37T221U349">fm</span>)</span>*<span class="var type1" id="S45T17U350">Pwt_p</span></span></span> + <span class="mxinfo " id="T27:U114"><span class="mxinfo " id="T28:U115"><span class="var type1" id="S39T1U354">T</span>^3*<span class="var type1" id="S35T7U356">qw</span></span>*<span class="mxinfo " id="T303:U118">fi(1/3, 0, 16, 17, <span class="var type1" id="S37T221U365">fm</span>)</span></span></span>, 0, 16, 6, <span class="var type1" id="S37T221U369">fm</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="8,44" id="srcline44"> 44</a></span><span class="line">    <span class="mxinfo " id="T16:U121"><span class="var type1" id="S50T16U372">Pwb</span> = <span class="mxinfo " id="T16:U123">fi(<span class="var type1" id="S44T16U375">Pwb_p</span>, 1, 16, 12, <span class="var type1" id="S37T221U379">fm</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="8,45" id="srcline45"> 45</a></span><span class="line">    <span class="mxinfo " id="T17:U126"><span class="var type1" id="S51T17U382">Pwt</span> = <span class="mxinfo " id="T17:U128">fi(<span class="mxinfo " id="T29:U129"><span class="mxinfo " id="T30:U130"><span class="mxinfo " id="T31:U131"><span class="var type1" id="S39T1U388">T</span>*<span class="var type1" id="S46T14U389">Pww_p</span></span> + <span class="var type1" id="S45T17U390">Pwt_p</span></span> + <span class="mxinfo " id="T19:U135"><span class="mxinfo " id="T314:U136">fi(1/2*<span class="var type1" id="S39T1U399">T</span>^2, 0, 16, 32, <span class="var type1" id="S37T221U404">fm</span>)</span>*<span class="var type1" id="S35T7U405">qw</span></span></span>, 0, 16, 10, <span class="var type1" id="S37T221U409">fm</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="8,46" id="srcline46"> 46</a></span><span class="line">    <span class="mxinfo " id="T14:U141"><span class="var type1" id="S52T14U412">Pww</span> = <span class="mxinfo " id="T14:U143">fi(<span class="mxinfo " id="T32:U144"><span class="var type1" id="S46T14U416">Pww_p</span> + <span class="mxinfo " id="T33:U146"><span class="var type1" id="S39T1U418">T</span>*<span class="var type1" id="S35T7U419">qw</span></span></span>, 0, 16, 13, <span class="var type1" id="S37T221U423">fm</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="8,47" id="srcline47"> 47</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="8,48" id="srcline48"> 48</a></span><span class="line">    <span class="mxinfo " id="T34:U150"><span class="var type1" id="S30T34U426">P</span> = <span class="mxinfo " id="T34:U152">fi(<span class="mxinfo " id="T34:U153">[<span class="mxinfo " id="T325:U154"><span class="mxinfo " id="T35:U155">fi(<span class="var type1" id="S52T14U433">Pww</span>, 1, 16, 5, <span class="var type1" id="S37T221U437">fm</span>)</span>, <span class="var type1" id="S51T17U438">Pwt</span>, <span class="var type1" id="S50T16U439">Pwb</span></span>; <span class="mxinfo " id="T325:U160"><span class="mxinfo " id="T35:U161">fi(<span class="var type1" id="S51T17U443">Pwt</span>, 1, 16, 5, <span class="var type1" id="S37T221U447">fm</span>)</span>, <span class="var type1" id="S49T15U448">Ptt</span>, <span class="var type1" id="S48T13U449">Ptb</span></span>; <span class="mxinfo " id="T326:U166"><span class="mxinfo " id="T13:U167">fi(<span class="var type1" id="S50T16U453">Pwb</span>, 1, 16, 9, <span class="var type1" id="S37T221U457">fm</span>)</span>, <span class="var type1" id="S48T13U458">Ptb</span>, <span class="var type1" id="S47T14U459">Pbb</span></span>]</span>, 1, 16, 5, <span class="var type1" id="S37T221U463">fm</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="8,49" id="srcline49"> 49</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="8,50" id="srcline50"> 50</a></span><span class="line"></span></span>
</pre>
